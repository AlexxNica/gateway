<!DOCTYPE html>
<meta charset="utf-8" />
<title>WebSocket Test</title>
<script src="gateway.js"></script>
<script language="javascript" type="text/javascript">

var output;

function init() {
    output = document.getElementById("output");
    var handle_connect = function() {
        write_to_screen("CONNECTED");
        test(client);
    };
    var client = new GatewayClient("ws://localhost:8888/", handle_connect);
}

function write_to_screen(message) {
    var pre = document.createElement("p");
    pre.style.wordWrap = "break-word";
    pre.innerHTML = message;
    output.appendChild(pre);
}

window.addEventListener("load", init, false);

function test(client) {
    client.fetch_last_height(height_fetched);
    client.fetch_transaction(
        "2604ba7d2190111dbc16b53b0f56ad4351ceabe1b9e1b4f6f1bc75e271bb09b9",
        tx_fetched);
    client.fetch_history("1DXrd29DHam37bXJQs5DTXKQwT1gmF4wDe", history_fetched);
}
function height_fetched(error, height) {
    if (error) {
        write_to_screen('<span style="color: red;">ERROR:</span> ' + error);
        return;
    }
    write_to_screen("Height: " + height);
}
function tx_fetched(error, tx) {
    if (error) {
        write_to_screen('<span style="color: red;">ERROR:</span> ' + error);
        return;
    }
    tx_str = JSON.stringify(tx, null, 2);
    write_to_screen("Tx: <pre>" + tx_str + "</pre>");
}
function history_fetched(error, history) {
    if (error) {
        write_to_screen('<span style="color: red;">ERROR:</span> ' + error);
        return;
    }
    history_str = JSON.stringify(history, null, 2);
    write_to_screen("History: <pre>" + history_str + "</pre>");
}

</script>

<h2>WebSocket Test</h2>
<div id="output"></div>

</html> 

